

# init env 
```
yum -y install wget net-tools bridge-utils && yum -y install epel-release && yum -y install unar

#caddy 
wget --no-check-certificate -O caddy_install.sh https://raw.githubusercontent.com/caonimagfw/Caddy/master/caddy_install.sh && bash caddy_install.sh

:80 {
	redir https://{host}
}
:8099 {
	root /usr/local/caddy/www
	gzip
}
#bbr
wget --no-check-certificate -O onefast.sh https://raw.githubusercontent.com/caonimagfw/onefast/master/onefast.sh && bash onefast.sh

sysctl -w net.ipv4.ip_forward=1

# install docker 

# clear all docker 
yum list installed|grep docker 


systemctl stop docker

yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine
yum list installed | grep docker

yum -y remove xxxx


# install some tools 

yum install -y yum-utils device-mapper-persistent-data lvm2


yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo



#yum-config-manager --enable docker-ce-nightly
#yum-config-manager --disable docker-ce-test

yum makecache fast

yum makecache fast
yum list docker-ce --showduplicates | sort -r

yum list docker-ce --showduplicates | sort -r
 3:19.03.11-3.el7 

yum -y install docker-ce-19.03.11-3.el7 docker-ce-cli-19.03.11-3.el7 containerd.io

yum -y install docker-ce-19.03.11 docker-ce-cli-19.03.11 containerd.io

systemctl start docker
```

# get imge
```
cd /root && mkdir docker && cd docker
wget --no-check-certificate https://xxx:8099/trojan-go.tar.gz
wget --no-check-certificate  https://github.com/caonimagfw/LuyouFrame/raw/master/18.06.8/Mine/openwrt-go.rar


reboot
```

# setting docker
```

cd /root/docker
docker import xx.tar.gz trojango 
#run 
docker run -it -d -p 8010:80 -p 8020:443 --restart always --name openwrt trojango /sbin/init

docker run -it -d -e DOCKER_TLS_CERTDIR= -p 8010:80 -p 8020:443 --restart always --name openwrt trojango /sbin/init

# go in #########################################
docker exec -it openwrt /bin/sh

vi /etc/config/uhttpd
/etc/init.d/uhttpd stop && /etc/init.d/uhttpd start

docker cp /www/runoob 96f7f14e99ab:/etc/init.d/trojan_go

systemctl stop firewalld && systemctl stop docker &&  yum -y upgrade firewalld


# systemctl restart firewalld &&  firewall-cmd --reload && systemctl restart docker
# iptables -L DOCKER
# docker stop openwrt && docker rm openwrt
```

# set network 
```
#check port
 netstat -tulpn | grep :443
 ####

#### 1. firewall-cmd --permanent --zone=trusted --add-port=8099/tcp 
	 2. firewall-cmd --permanent --zone=trusted --add-interface=docker0
	 3. firewall-cmd --reload && firewall-cmd --permanent --list-all --zone=trusted


public  masquerade

ip link set dev docker0 down

systemctl stop docker
systemctl restart firewalld
systemctl restart docker
iptables -L DOCKER




firewall-cmd --zone=public --add-forward-port=port=2010:proto=tcp:toport=8010 --permanent  
firewall-cmd --zone=public --add-forward-port=port=2020:proto=tcp:toport=8020 --permanent 
firewall-cmd --add-port=8099/tcp --permanent
firewall-cmd --zone=public --add-port=80/tcp --permanent
firewall-cmd --reload && firewall-cmd --list-all


firewall-cmd --zone=public --add-forward-port=port=810:proto=tcp:toport=8020 --permanent  && firewall-cmd --reload 



firewall-cmd --add-port=8888/tcp --permanent && firewall-cmd --reload 
firewall-cmd --add-port=8099/tcp --permanent && firewall-cmd --reload 
firewall-cmd --add-port=8099/tcp --permanent && firewall-cmd --reload 

firewall-cmd --add-port=30000-60000/tcp --permanent && firewall-cmd --reload 

firewall-cmd --add-port=2010/tcp --add-port=2020/tcp  --permanent && firewall-cmd --reload 

firewall-cmd --remove-port=8888/tcp --permanent && firewall-cmd --reload 
firewall-cmd --remove-port=443/tcp --permanent && firewall-cmd --reload && firewall-cmd --permanent --list-all

firewall-cmd --remove-port=443/tcp --permanent && firewall-cmd --reload && firewall-cmd --permanent --list-all
firewall-cmd --remove-port=2010/tcp --permanent && firewall-cmd --reload && firewall-cmd --permanent --list-all


firewall-cmd --zone=public --remove-forward-port=port=80:proto=tcp:toport=8010 --permanent
firewall-cmd --zone=public --remove-forward-port=port=8888:proto=tcp:toport=8010 --permanent && firewall-cmd --reload 

firewall-cmd --zone=public --remove-forward-port=port=2010:proto=tcp:toport=8010 --permanent && firewall-cmd --reload && firewall-cmd --permanent --list-all

#open port
firewall-cmd --add-port=443/tcp --add-port=80/tcp --add-port=8888/tcp --permanent 
#forward port
firewall-cmd --add-masquerade --permanent
firewall-cmd --zone=public --add-forward-port=port=8888:proto=tcp:toport=8010 --permanent
firewall-cmd --zone=public --add-forward-port=port=443:proto=tcp:toport=8020 --permanent
firewall-cmd --reload 
firewall-cmd --permanent --list-port

firewall-cmd --zone=public --add-forward-port=port=2010:proto=tcp:toport=8010 --permanent
firewall-cmd --zone=public --add-forward-port=port=2020:proto=tcp:toport=8020 --permanent
firewall-cmd --reload 
firewall-cmd --permanent --list-all


firewall-cmd --permanent --zone=trusted --add-interface=docker0
firewall-cmd --permanent --zone=trusted --add-port=8099/tcp
firewall-cmd --permanent --zone=trusted --add-port=443/tcp
firewall-cmd --reload 

firewall-cmd --permanent --zone=trusted --add-interface=docker0 && firewall-cmd --reload 


firewall-cmd --remove-port=8888/tcp --permanent  && firewall-cmd --reload && firewall-cmd --list-all
firewall-cmd --remove-forward-port=port=8888:proto=tcp:toport=8010 --permanent  && firewall-cmd --reload && firewall-cmd --list-all

firewall-cmd --zone=public --add-forward-port=port=2020:proto=tcp:toport=8020 --permanent
firewall-cmd --add-port=2020/tcp --permanent
firewall-cmd --reload 


firewall-cmd --zone=public --remove-forward-port=port=443:proto=tcp:toport=8020 --permanent
firewall-cmd --zone=public --add-forward-port=port=443:proto=tcp:toport=8020 --permanent && firewall-cmd --reload && firewall-cmd --list-all
firewall-cmd --reload 

firewall-cmd --list-all


```

# swap memory 
```
cat /proc/swaps

mkdir /data
dd if=/dev/zero of=/data/swap bs=128 count=8388616
mkswap /data/swap

swapon /data/swap   
echo "/data/swap swap swap defaults    0  0" >> /etc/fstab

free -h

```

# error 
```
t: iproute: "ip -4 neigh flush dev eth0" hangs up
ip -4 addr flush dev eth0


can't access internet 

# Luci Error  /etc/config/luci seems to be corrupt, unable to find section 'main'
/etc/init.d/rpcd restart
/etc/init.d/uhttpd restart

# no chain name iptables 
# before run docker, run below code 
systemctl stop docker && systemctl restart firewalld  && systemctl restart docker && iptables -L DOCKER



```

# container
```
docker commit -p idid  name:v2

#export and import 
#save and load

#export 
docker images
docker export d65 > /usr/local/caddy/www/v0.tar

#import 
docker import xx.tar openwrt


```


 firewall-cmd --zone=public --remove-forward-port=port=2020:proto=tcp:toport=8020 --permanent  && firewall-cmd --reload
firewall-cmd --remove-port=2020/tcp --zone=trusted --permanent  && firewall-cmd --reload && firewall-cmd --list-all


firewall-cmd --remove-port=443/tcp --zone=trusted --permanent  && firewall-cmd --reload && firewall-cmd --list-all

firewall-cmd --list-all --zone=trusted 

firewall-cmd --list-all --permanent 

firewall-cmd --zone=public --add-port=5001/tcp --permanent && firewall-cmd --reload



 firewall-cmd --zone=public --add-forward-port=port=5001:proto=tcp:toaddr=127.0.0.1:toport=5005 --permanent


firewall-cmd --reload 


firewall-cmd --reload



firewall-cmd --add-port=443/tcp --add-port=80/tcp --add-port=8100/tcp --permanent 

firewall-cmd --add-port=443/tcp --add-port=80/tcp --add-port=8100/tcp --permanent 



iptables -t nat -A PREROUTING -p tcp -i eth0 --dport 31521 -j DNAT --to 192.168.0.211:1521
iptables -t nat -A POSTROUTING -j MASQUERADE

service iptables save
service iptables restart

firewall-cmd --permanent --list-port


firewall-cmd --reload

--add-port=5005/tcp

firewall-cmd --zone=public --add-port=5001/tcp --permanent && firewall-cmd --reload

iptables -t nat -A PREROUTING -p tcp -i eth0 --dport 5005 -j DNAT --to 127.0.0.1:5001
iptables -t nat -A POSTROUTING -j MASQUERADE
service iptables save && service iptables restart

systemctl save iptables
yum install -y iptables-services
yum uninstall -y iptables-services
And then enable the service using systemd:

iptables-save && service iptables.service restart
iptables-reload

firewall-cmd --zone=public --list-ports

systemctl restart firewalld

 firewall-cmd --add-masquerade --permanent

 firewall-cmd --zone=public --add-forward-port=port=5001:proto=tcp:toaddr=127.0.0.1:toport=5005 --permanent
 firewall-cmd --reload

firewall-cmd --zone=public --add-forward-port=port=5001:proto=tcp:toport=5005 --permanent
firewall-cmd --reload

firewall-cmd --permanent --list-all


iptables-reload


# change ssh port
```

firewall-cmd --zone=public --add-port=xxx/tcp  --permanent && firewall-cmd --reload  &&  firewall-cmd --permanent --list-all


firewall-cmd --zone=public --remove-port=22/tcp --permanent && firewall-cmd --reload  &&  firewall-cmd --permanent --list-all

cp /etc/ssh/sshd_config /etc/ssh/sshd_config.bak

vi /etc/ssh/sshd_config
systemctl restart sshd


yum provides semanage
yum -y install policycoreutils-python


semanage port -a -t ssh_port_t -p tcp xxx
semanage port -l | grep ssh

semanage port -d -t ssh_port_t -p tcp 22

firewall-cmd --permanent --list-all --zone=trusted
firewall-cmd --permanent --list-all --zone=public

firewall-cmd --permanent --zone=public --remove-port=xxxx/tcp && firewall-cmd --reload

firewall-cmd --permanent --zone=trusted --add-port=xxxx/tcp && firewall-cmd --reload

firewall-cmd --permanent --zone=trusted --remove-port=xxxx/tcp && firewall-cmd --reload

firewall-cmd --permanent --zone=trusted --remove-interface=docker0 && firewall-cmd --reload


```