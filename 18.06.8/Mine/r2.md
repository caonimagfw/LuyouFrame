

# init env 
```
yum -y install wget net-tools bridge-utils && yum -y install epel-release && yum -y install unar

#caddy 
wget --no-check-certificate -O caddy_install.sh https://raw.githubusercontent.com/caonimagfw/Caddy/master/caddy_install.sh && bash caddy_install.sh

:80 {
	redir https://{host}
}
#bbr
wget --no-check-certificate -O onefast.sh https://raw.githubusercontent.com/caonimagfw/onefast/master/onefast.sh && bash onefast.sh

sysctl -w net.ipv4.ip_forward=1

#docker 
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh

```

# get imge
```
cd /root && mkdir docker && cd docker
wget --no-check-certificate https://xxx:8099/trojan-go.tar.gz

reboot
```

# setting docker
```
cd /root/docker
docker import xx.tar.gz trojango 
#run 
docker run -it -d -p 8010:80 -p 8020:443 --restart always --name openwrt trojango /sbin/init

docker run -it -d -e DOCKER_TLS_CERTDIR= -p 8010:80 -p 8020:443 --restart always --name openwrt trojango /sbin/init

# go in 
docker exec -it openwrt /bin/sh

vi /etc/config/uhttpd
/etc/init.d/uhttpd stop && /etc/init.d/uhttpd start

docker cp /www/runoob 96f7f14e99ab:/etc/init.d/trojan_go

#systemctl restart firewalld &&  firewall-cmd --reload && systemctl restart docker
# iptables -L DOCKER
# docker stop openwrt && docker rm openwrt
```

# set network 
```
firewall-cmd --zone=public --add-forward-port=port=2020:proto=tcp:toport=8020 --permanent && firewall-cmd --reload

firewall-cmd --add-port=8888/tcp --permanent && firewall-cmd --reload 
firewall-cmd --remove-port=8888/tcp --permanent && firewall-cmd --reload 

firewall-cmd --zone=public --remove-forward-port=port=80:proto=tcp:toport=8010 --permanent

#open port
firewall-cmd --add-port=443/tcp --add-port=80/tcp --add-port=8888/tcp --permanent 
#forward port
firewall-cmd --add-masquerade --permanent
firewall-cmd --zone=public --add-forward-port=port=8888:proto=tcp:toport=8010 --permanent
firewall-cmd --zone=public --add-forward-port=port=443:proto=tcp:toport=8020 --permanent
firewall-cmd --reload 
firewall-cmd --permanent --list-port

firewall-cmd --permanent --zone=trusted --add-interface=docker0
firewall-cmd --permanent --zone=trusted --add-port=8099/tcp
firewall-cmd --permanent --zone=trusted --add-port=443/tcp
firewall-cmd --reload 

firewall-cmd --zone=public --add-forward-port=port=2020:proto=tcp:toport=8020 --permanent
firewall-cmd --add-port=2020/tcp --permanent
firewall-cmd --reload 


firewall-cmd --zone=public --remove-forward-port=port=443:proto=tcp:toport=8020 --permanent
firewall-cmd --zone=public --add-forward-port=port=2020:proto=tcp:toport=8020 --permanent
firewall-cmd --reload 
```

# swap memory 
```
cat /proc/swaps

mkdir /data
dd if=/dev/zero of=/data/swap bs=128 count=8388616
mkswap /data/swap

swapon /data/swap   
echo "/data/swap swap swap defaults    0  0" >> /etc/fstab

free -h

```

# error 
```
t: iproute: "ip -4 neigh flush dev eth0" hangs up
ip -4 addr flush dev eth0


can't access internet 

# Luci Error  /etc/config/luci seems to be corrupt, unable to find section 'main'
/etc/init.d/rpcd restart
/etc/init.d/uhttpd restart

# no chain name iptables 
# before run docker, run below code 
systemctl stop docker && systemctl restart firewalld  && systemctl restart docker && iptables -L DOCKER



```

# container
```
docker commit -p idid  name:v2

#export and import 
#save and load

#export 
docker images
docker export d65 > /usr/local/caddy/www/v0.tar

#import 
docker import xx.tar openwrt


```


firewall-cmd --zone=public --add-port=5001/tcp --permanent && firewall-cmd --reload



 firewall-cmd --zone=public --add-forward-port=port=5001:proto=tcp:toaddr=127.0.0.1:toport=5005 --permanent


firewall-cmd --reload 


firewall-cmd --reload



firewall-cmd --add-port=443/tcp --add-port=80/tcp --add-port=8100/tcp --permanent 

firewall-cmd --add-port=443/tcp --add-port=80/tcp --add-port=8100/tcp --permanent 



iptables -t nat -A PREROUTING -p tcp -i eth0 --dport 31521 -j DNAT --to 192.168.0.211:1521
iptables -t nat -A POSTROUTING -j MASQUERADE

service iptables save
service iptables restart

firewall-cmd --permanent --list-port


firewall-cmd --reload

--add-port=5005/tcp

firewall-cmd --zone=public --add-port=5001/tcp --permanent && firewall-cmd --reload

iptables -t nat -A PREROUTING -p tcp -i eth0 --dport 5005 -j DNAT --to 127.0.0.1:5001
iptables -t nat -A POSTROUTING -j MASQUERADE
service iptables save && service iptables restart

systemctl save iptables
yum install -y iptables-services
yum uninstall -y iptables-services
And then enable the service using systemd:

iptables-save && service iptables.service restart
iptables-reload

firewall-cmd --zone=public --list-ports

systemctl restart firewalld

 firewall-cmd --add-masquerade --permanent

 firewall-cmd --zone=public --add-forward-port=port=5001:proto=tcp:toaddr=127.0.0.1:toport=5005 --permanent
 firewall-cmd --reload

firewall-cmd --zone=public --add-forward-port=port=5001:proto=tcp:toport=5005 --permanent
firewall-cmd --reload

firewall-cmd --permanent --list-all


iptables-reload


```



```